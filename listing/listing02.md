Что выведет программа? Объяснить вывод программы. Объяснить как работают defer’ы и порядок их вызовов.


package main
 
import (
    "fmt"
)
 
func test() (x int) {
    defer func() {
        x++
    }()
    x = 1
    return
}
 
 
func anotherTest() int {
    var x int
    defer func() {
        x++
    }()
    x = 1
    return x
}
 
 
func main() {
    fmt.Println(test())
    fmt.Println(anotherTest())
}

Ответ:

2
1

Объяснение:

1. В функции test, defer откладывает выполнение анонимной функции, которая увеличивает значение x на 1.
Затем x устанавливается в 1, и затем функция возвращает значение x.
После выполнения return отрабатывает отложенная функция defer, увеличивая x на 1, и окончательное значение x становится 2.

2. В функции anotherTest, defer также откладывает выполнение анонимной функции, которая увеличивает значение x на 1.
В отличие от предыдущего случая, функция возвращает текущее значение x, которое равно 1.
После выполнения return отложенная функция defer отрабатывает, но увеличивает уже копию x, не влияя на возвращаемое значение. 
Поэтому результат остается 1